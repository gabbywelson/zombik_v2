---
import { hasImageAsset, urlForImage } from '../lib/sanity.client';
import type { SanityImageSource } from '../lib/sanity.types';

interface Props {
  image?: SanityImageSource;
  alt?: string;
  class?: string;
  sizes?: string;
  loading?: 'lazy' | 'eager';
}

const {
  image,
  alt = '',
  class: className = '',
  sizes = '(max-width: 800px) 92vw, 720px',
  loading = 'lazy',
} = Astro.props;

const widths = [480, 768, 1024, 1440];

const srcset = hasImageAsset(image)
  ? widths
      .map((width) => `${urlForImage(image).width(width).quality(80).url()} ${width}w`)
      .join(', ')
  : null;

const src = hasImageAsset(image)
  ? urlForImage(image).width(1200).quality(85).url()
  : null;
---

{
  src && (
    <img
      src={src}
      srcset={srcset ?? undefined}
      sizes={sizes}
      alt={alt}
      class={className}
      loading={loading}
      decoding="async"
    />
  )
}
