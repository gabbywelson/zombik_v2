---
import PostCard from "../components/PostCard.astro";
import SanityImage from "../components/SanityImage.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import {
  getHomePageData,
  getPostIndexData,
  getWritingIndexData,
} from "../lib/content";
import { hasImageAsset } from "../lib/sanity.client";

const [homePage, posts, writingEntries] = await Promise.all([
  getHomePageData(),
  getPostIndexData(),
  getWritingIndexData(),
]);

const featuredPosts =
  homePage.featuredPosts.length > 0
    ? homePage.featuredPosts
    : posts.slice(0, 3);
const featuredWriting = writingEntries.slice(0, 2);
const hasHomeHeroImage = hasImageAsset(homePage.heroImage);
---

<BaseLayout
  title="Home"
  description="Essays, fiction, and notes by Chris Zombik."
  socialImage={homePage.heroImage}
  socialImageAlt={homePage.heroImage?.alt ?? "Chris Zombik homepage hero image"}
>
  <section class:list={["home-hero", "reveal", { "home-hero-has-image": hasHomeHeroImage }]}>
    {
      hasHomeHeroImage && (
        <>
          <div class="home-hero-media" aria-hidden="true">
            <SanityImage
              image={homePage.heroImage}
              alt=""
              class="home-hero-image"
              sizes="(max-width: 1200px) 100vw, 1200px"
              loading="eager"
            />
          </div>
          <div class="home-hero-overlay" aria-hidden="true"></div>
        </>
      )
    }
    <p class="home-eyebrow">chriszombik.com</p>
    <h1>{homePage.heroHeading}</h1>
    <p class="home-subheading">{homePage.heroSubheading}</p>

    <!-- TODO - if we want to add separate intro for home page, we can use this -->
    <!-- <RichTextRenderer
      value={homePage.intro}
      includeFootnotes={false}
      class="home-intro"
    /> -->
  </section>

  <section class="working-on reveal" style="--reveal-delay: 80ms;">
    <div class="section-heading">
      <h2>What I&apos;m working on</h2>
    </div>

    <div class="working-on-grid">
      <article class="working-on-card">
        <p class="home-eyebrow">Current Project</p>
        <h3>The novel</h3>
        <p>{homePage.novelCardCopy}</p>
      </article>

      <article class="working-on-card">
        <p class="home-eyebrow">Current Project</p>
        <h3>The memoir</h3>
        <p>{homePage.memoirCardCopy}</p>
      </article>
    </div>
  </section>

  <section class="featured-writing reveal" style="--reveal-delay: 120ms;">
    <div class="section-heading">
      <h2>Featured Posts</h2>
      <a href="/posts" class="section-link">View all posts</a>
    </div>

    {
      featuredPosts.length === 0 ? (
        <p>No posts published yet.</p>
      ) : (
        <div class="post-grid">
          {featuredPosts.map((post) => (
            <PostCard post={post} hrefPrefix="/posts" />
          ))}
        </div>
      )
    }
  </section>

  {
    featuredWriting.length > 0 && (
      <section class="featured-writing reveal" style="--reveal-delay: 200ms;">
        <div class="section-heading">
          <h2>Latest Writing</h2>
          <a href="/writing" class="section-link">
            View all writing
          </a>
        </div>

        <div class="post-grid">
          {featuredWriting.map((entry) => (
            <PostCard
              post={entry}
              hrefPrefix="/writing"
              showHeroImage={false}
              showTags={false}
            />
          ))}
        </div>
      </section>
    )
  }
</BaseLayout>
