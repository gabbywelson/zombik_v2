---
import RichTextRenderer from '../../components/RichTextRenderer.astro';
import TagList from '../../components/TagList.astro';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getWritingBySlug, getWritingSlugs } from '../../lib/content';
import { formatDate } from '../../lib/format';

export async function getStaticPaths() {
  const slugs = await getWritingSlugs();

  return slugs.map((slug) => ({
    params: { slug },
  }));
}

const slug = Astro.params.slug ?? '';
const post = await getWritingBySlug(slug);

if (!post) {
  throw new Error(`Writing entry not found for slug: ${slug}`);
}
---

<BaseLayout title={post.title} description={post.excerpt}>
  <article class="post-page reveal">
    <header class="post-header">
      <p class="post-meta">
        <span>{formatDate(post.publishedAt)}</span>
      </p>

      <h1>{post.title}</h1>
      <p class="post-excerpt">{post.excerpt}</p>
      <TagList tags={post.tags} hrefBase="/writing" />
    </header>

    <RichTextRenderer value={post.body} footnotePrefix={`writing-${post.slug}`} />
  </article>
</BaseLayout>
